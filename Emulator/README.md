# Waveform Simulation
usage:
```shell
WaveformSimu data.root output.dat waveform_template.yaml
```

## Output file format
The output file is designed to store various data packets, with each packet representing a triggered PMT.
As of the current configuration, each data packet includes the following information:

```
protocol, packet_size, channel_id, event_id / time_stamp, t_busy, v0, v1, ..., v499
```

Here's a breakdown of each field:

    protocol: This field is fixed at 0xb2 (hexadecimal) or 178 (decimal) and signifies the protocol used.
    
    packet_size: This field is the size of current packet (in Byte). For now, packet_size = 1024 Byte.

    channel_id: This field is calculated as DomId * 100 + PmtId. It uniquely identifies the source of the data.

    event_id / time_stamp: This field contains either the event ID or a timestamp, depending on the specific context. It provides information about when the data was recorded.

    t_busy: This filed = 0 for now.

    v0, v1, ..., v999: These fields represent the voltage values for each of the 2500 bins. Each bin corresponds to a time interval of 2ns.

Consequently, the total length of each data packet is 505, including all the mentioned fields and their respective values.


## Guide to Interpreting the Emulator Output

To effectively read and interpret the output generated by the Emulator, you can follow these steps:

1. **Utilize the `raw_reader` Program**:
    - Execute the command `raw_reader output.dat > output.txt`.
    - This command transforms the binary file `output.dat` into a readable text file `output.txt`.

2. **Develop a Custom Python Script**:
    - Alternatively, you can write your own Python script to parse and analyze the `.txt` file. Below is an example script for your reference:

   ```python
   import numpy as np
   import pandas as pd

   # Loading data from the text file
   bin_txt_path = "output.txt"
   data_b = np.loadtxt(bin_txt_path)

   # Organizing the data into a Pandas DataFrame
   out_columns = ['protocol', 'block_size', 'channel_id', 'event_id', 't_busy'] + [f'bin{i}' for i in range(500)]
   out_data = pd.DataFrame(data=data_b.reshape(-1, 505), columns=out_columns)

   # Adding columns for Domain ID (DomId) and Photomultiplier Tube ID (PmtId)
   out_data['DomId'] = out_data.channel_id.astype('int') // 100
   out_data['PmtId'] = out_data.channel_id - out_data.DomId * 100
   ```